{% extends 'main-base.html' %}

{% block title %}Profile - Exercise Tracker{% endblock %}
{% block page_title %}Profile{% endblock %}

{% block content %}
<div class="main-content-boxes profile">
    <!-- Display Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="alert-container">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} mt-3">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <h2>Your Profile</h2>

    <!-- Display Current Info -->
    <div class="mb-4">
        <p><strong>Username:</strong> {{ user.username }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Full Name:</strong> {{ user.full_name or 'N/A' }}</p>
        <p><strong>Date of Birth:</strong> {{ user.dob.strftime('%Y-%m-%d') if user.dob else 'N/A' }}</p>
        <p><strong>Gender:</strong> {{ user.gender or 'N/A' }}</p>
        <p><strong>Height (cm):</strong> {{ user.height_cm or 'N/A' }}</p>
        <p><strong>Weight (kg):</strong> {{ user.weight_kg or 'N/A' }}</p>
        <p><strong>Joined:</strong> {{ user.created_at.strftime('%Y-%m-%d') }}</p>
    </div>

    <!-- Update Profile Button -->
    <button type="button" class="btn btn-primary mb-3" id="showUpdateFormBtn">Update Profile</button>

    <!-- Hidden Form for updating (ONLY appears after clicking Update Profile) -->
    <form method="POST" id="updateForm" style="display: none;">
        <!-- Editable fields here -->
        <div class="mb-3">
            <label for="username" class="form-label">New Username</label>
            <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}">
        </div>

        <div class="mb-3">
            <label for="email" class="form-label">New Email</label>
            <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}">
        </div>

        <div class="mb-3">
            <label for="full_name" class="form-label">Full Name</label>
            <input type="text" class="form-control" id="full_name" name="full_name" value="{{ user.full_name }}">
        </div>

        <div class="mb-3">
            <label for="dob" class="form-label">Date of Birth</label>
            <input type="date" class="form-control" id="dob" name="dob" value="{{ user.dob.strftime('%Y-%m-%d') if user.dob else '' }}">
        </div>

        <div class="mb-3">
            <label for="gender" class="form-label">Gender</label>
            <select class="form-control" id="gender" name="gender">
                <option value="">Select</option>
                <option value="Male" {% if user.gender == 'Male' %}selected{% endif %}>Male</option>
                <option value="Female" {% if user.gender == 'Female' %}selected{% endif %}>Female</option>
                <option value="Other" {% if user.gender == 'Other' %}selected{% endif %}>Other</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="height_cm" class="form-label">Height (cm)</label>
            <input type="number" step="0.1" class="form-control" id="height_cm" name="height_cm" value="{{ user.height_cm }}">
        </div>

        <div class="mb-3">
            <label for="weight_kg" class="form-label">Weight (kg)</label>
            <input type="number" step="0.1" class="form-control" id="weight_kg" name="weight_kg" value="{{ user.weight_kg }}">
        </div>

        <div class="mb-3">
            <label for="current_password" class="form-label">Current Password</label>
            <input type="password" class="form-control" id="current_password" name="current_password" required>
        </div>

        <button type="submit" class="btn btn-success w-100">Save Changes</button>
    </form>
</div>

<!-- JavaScript to handle showing the form -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const updateButton = document.getElementById('showUpdateFormBtn');
    const updateForm = document.getElementById('updateForm');

    updateButton.addEventListener('click', function() {
        console.log("Update button clicked!");  // Debugging log to check if button click works
        updateForm.style.display = 'block';   // Show the update form
        updateButton.style.display = 'none';  // Hide the button
    });
});
</script>

{% endblock %}
